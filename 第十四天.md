# 用户 角色 权限 三者的关系

用户 角色 == 权限
张三 主管 == 用户管理/权限管理/商品管理
李四 班长 == 商品管理

# 权限 rights

- 处理左边的 索引

```html
 <el-table-column
      type="index"     // 添加索引了 , 默认从1开始
      :index="indexMethod">  // 处理索引从0开始
    </el-table-column>
```

- 处理右边的 等级

```html
<template slot-scope="scope">
  <span v-if="scope.row.level == 0">一级</span>
  <span v-else-if="scope.row.level==1">二级</span>
  <span v-else>三级</span>
</template>
```

# es6 语法解构

# 角色列表

1. 展示列表数据
2. 把数据赋值给 rolesList 之后,会报错 要 rowKey , 但是我们的需求和数据和 element-ui 不匹配

- 降低版本 `npm i element-ui@2.4.11`

# 角色列表 => 展开行显示权限 (左侧)

1. 展示权限初稿

```html
<template slot-scope="scope">
  <!-- 第一层 -->
  <el-row v-for="item1 in scope.row.children" :key="item1.id">
    <el-col :span="4">{{ item1.authName }}</el-col>
    <el-col :span="20">
      <!-- 第二层 -->
      <el-row v-for="item2 in item1.children" :key="item2.id">
        <el-col :span="4">{{ item2.authName }}</el-col>
        <el-col :span="20">
          <!-- 第三层 -->
          <span v-for="item3 in item2.children" :key="item3.id"
            >{{ item3.authName }}</span
          >
        </el-col>
      </el-row>
    </el-col>
  </el-row>
</template>
```

# all-接口

> https://gitee.com/xiaomage666666/api_all/settings

# 角色列表 => 分配权限 (右侧)

### 1. 弹出对话框

> 参考 => 树型控件 => 默认展开和默认选中

### 2. 展示所有的权限数据

```js
  defaultProps: {
        // children : 结构
        children: 'children',
        // label : 显示名称
        label: 'authName'
      }
```

### 3. 展示已有的权限

> 参考 : 树节点的选择
> this.\$refs.tree.setCheckedKeys([3]);

```js

 // 1. 展示对话框
      this.dialogAssignRightsVisible = true

      {
        // 2.显示已经拥有的权限  添加商品
        // DOM异步更新
        // 方式1 : 延时器
        // setTimeout(() => {
        //   console.log(this.$refs)
        // }, 1000)
        // 方式2 : nextTick DOM更新完毕自动调用回调
      }

      // 2. 获取当前角色的第三层id
      let keys = []
      row.children.forEach(item1 => {
        item1.children.forEach(item2 => {
          item2.children.forEach(item3 => {
            console.log(item3.id)
            keys.push(item3.id)
          })
        })
      })

      this.$nextTick(() => {
        this.$refs.tree.setCheckedKeys(keys)
      })
    }
```

- pid 父节点的 id
  {
  id : 001
  name : '上海市',
  children : [
  {
  id : 002,
  name : "浦东新区",
  pid : 001,
  children : [
  {
  id : 004
  name :'航头',
  pid : '001,002'
  },
  {
  id : 005
  name : '新场',
  pid : '001,002'
  }
  ]
  },
  {
  id : 003,
  name : "闵行区",
  pid : 001
  }
  ]
  }

### 4. 发送请求分配权限

> 需要两个参数
>
> 1. roleId => 点击弹窗的时候,因为传过来一个 row 对象,所以可以拿到 row 里的 id
>    保存起来 : this.roleId = row.id
> 2. rids => 所有的权限 id (半选的 和 全选的 )

- rids : keys.join(',')

# (给用户)分配角色 (users.vue)

### 1. 弹出对话框  ok

### 2. 展示所有的角色
- 获取所有的角色
- v-for遍历数组 创建 option
- label :  展示 的  item.roleName
- value :  收集角色id  item.id


### 3. 展示自己当前的角色
### 4. 提交给后台分配后的角色
